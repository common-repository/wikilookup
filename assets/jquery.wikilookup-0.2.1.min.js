!function(t){t.wikilookup||(t.wikilookup={})}(jQuery),jQuery.wikilookup.tools={getPropValue:function(t,e){for(var i=t||{},s=0;i=i[e[s]],s++,i&&s<e.length;);return i}},function(r){function t(t){t=t||{},this.cache={},this.promises={},this.standardURLs={restBase:"https://{{lang}}.wikipedia.org/api/rest_v1/page/summary/{{pageName}}",api:"https://{{lang}}.wikipedia.org/w/api.php"},this.lang=t.lang||"en",this.useRestbase=!!t.useRestbase,this.baseURL=t.baseURL,this.logo=r.extend({url:"",title:""},t.logo),this.baseURL||(this.baseURL=this.useRestbase?this.standardURLs.restBase:this.standardURLs.api),this.isWikipedia=!!this.baseURL.match(/https:\/\/(.+)\.wikipedia.org/)}t.prototype.getPageInfo=function(e,t){var i=this,s=this.getCacheKey(e,t);return this.cache[s]?r.Deferred().resolve(this.cache[s]):this.promises[s]?this.promises[s]:this.fetch(e,t).then(function(t){return i.updateCache(e,t),t})},t.prototype.fetch=function(t,e){var i,s=this,o=this.getCacheKey(t,e);return i=r.ajax(this.getApiParams(t,e)).then(function(t){return s.promises[o]=null,s.processApiResult(t)},function(){return s.promises[o]=null,"error"}).then(function(t){return s.promises[o]=null,"error"===t||"missing"===t?r.Deferred().reject(t):t}),this.promises[o]=i},t.prototype.processApiResult=function(t){var e,i;return t?this.useRestbase?"https://mediawiki.org/wiki/HyperSwitch/errors/not_found"===t.type?"missing":{title:t.displaytitle,content:t.extract,thumbnail:t.thumbnail||{},url:t.content_urls.desktop.page,history:t.content_urls.desktop.revisions,dir:t.dir||"ltr",wikipedia:this.isWikipedia,source:{logo:this.logo.url,title:this.logo.title}}:(e=(i=r.wikilookup.tools.getPropValue(t,["query","pages"]))[Object.keys(i)[0]])?void 0!==e.missing?"missing":{title:e.title,content:e.extract,thumbnail:e.thumbnail,url:e.canonicalurl,history:e.fullurl+"?action=history",dir:e.pagelanguagedir||"ltr",wikipedia:this.isWikipedia,source:{logo:this.logo.url,title:this.logo.title}}:"error":"error"},t.prototype.updateCache=function(t,e){this.cache[this.getCacheKey(t)]=e},t.prototype.getCacheKey=function(t,e){return(e=e||this.lang)+"|"+t.trim().toLowerCase().replace(new RegExp(/\s/g),"_")},t.prototype.getApiUrl=function(t,e){return this.baseURL.replace("{{lang}}",encodeURIComponent(e||this.lang)).replace("{{pageName}}",encodeURIComponent(t))},t.prototype.getApiParams=function(t,e){var i=this.getApiUrl(t,e);return this.useRestbase?{url:i,data:{redirect:!0}}:{url:i,dataType:"jsonp",data:{action:"query",format:"json",prop:"info|pageimages|extracts",titles:t,inprop:"url",piprop:"thumbnail",pithumbsize:300,redirects:"1",exsentences:5,exintro:"1"}}},r.wikilookup.Api=t}(jQuery),function(e){function t(t){t=t||{},this.$element=t.$element||e("<div>"),this.hideThumb=!!t.hideThumb,this.messages=e.extend({},{link:"Learn more",pending:"Loading...",articleHistory:"Revision history",error:"There was a problem loading this page information.",wikimediaParticipate:"Participate"},t.messages),this.$pending=this.buildPending(),this.$view=this.buildView(),this.$error=this.buildError(),this.$creditBar=this.buildCredidBar(),this.dark=!1,this.setState("pending"),this.toggleDarkMode(!!t.dark),this.$element.addClass("wl-pageInfoWidget").append(this.$pending,this.$error,this.$view,this.$creditBar)}t.prototype.toggleDarkMode=function(t){this.dark=void 0===t?!this.dark:!!t,this.$element.toggleClass("wl-dark",this.dark)},t.prototype.setState=function(e){var t=["pending","ready","error"];this.state!==e&&-1<t.indexOf(e)&&(t.forEach(function(t){this.$element.toggleClass("wl-pageInfoWidget-state-"+t,e===t)}.bind(this)),this.state=e)},t.prototype.getState=function(){return this.state},t.prototype.buildCredidBar=function(){return this.$wikimediaSupport=e("<a>").attr("target","_blank").attr("href","https://wikimediafoundation.org/support/").text("Support MediaWiki"),e("<div>").addClass("wl-pageInfoWidget-creditbar").append(e("<div>").addClass("wl-pageInfoWidget-creditbar-actions").append(e("<div>").addClass("wl-pageInfoWidget-creditbar-actions-support").append(this.$wikimediaSupport)))},t.prototype.buildView=function(){return this.$logo=e("<div>").addClass("wl-pageInfoWidget-view-logo"),this.$copyright=e("<a>").addClass("wl-pageInfoWidget-view-copyrightLink").text("See article for copyright information"),this.$title=e("<div>").addClass("wl-pageInfoWidget-view-title"),this.$content=e("<div>").addClass("wl-pageInfoWidget-view-content"),this.$thumb=e("<div>").addClass("wl-pageInfoWidget-view-thumb").append(e("<div>").addClass("wl-pageInfoWidget-view-thumb-fader")),this.$fader=e("<div>").addClass("wl-pageInfoWidget-view-fader"),this.$link=e("<a>").addClass("wl-pageInfoWidget-view-link").attr("target","_blank").append(this.messages.link),this.$historyLink=e("<a>").addClass("wl-pageInfoWidget-view-articleHistory").attr("target","_blank").append(this.messages.articleHistory),e("<div>").addClass("wl-pageInfoWidget-content-ready").append(e("<div>").addClass("wl-pageInfoWidget-box wl-pageInfoWidget-box-text").append(this.$logo,this.$title,this.$content,this.$link,this.$historyLink,this.$copyright),e("<div>").addClass("wl-pageInfoWidget-box wl-pageInfoWidget-box-image").append(this.$thumb))},t.prototype.setData=function(t){t=e.extend({thumbnail:{},source:{}},t),this.$title.text(t.title),this.$content.append(t.content,this.$fader),t.thumbnail.source&&(this.$thumb.css({backgroundImage:"url( "+t.thumbnail.source+" )",width:t.thumbnail.width,height:"100%",backgroundRepeat:"no-repeat",backgroundSize:"cover",backgroundPosition:"center"}),this.$creditBar.css({width:t.thumbnail.width})),this.$thumb.toggle(!!t.thumbnail.source&&!this.hideThumb),this.$element.attr("dir",t.dir||"ltr"),this.$link.attr("href",t.url),this.$copyright.attr("href",t.url),this.$historyLink.attr("href",t.history),this.$element.toggleClass("wl-pageInfoWidget-wikipedia",!!t.wikipedia).toggleClass("wl-pageInfoWidget-externalwiki",!t.wikipedia).toggleClass("wl-pageInfoWidget-customlogo",!t.wikipedia&&!!t.source.logo).toggleClass("wl-pageInfoWidget-noimage",!t.thumbnail.source),this.$wikimediaSupport.text(t.wikipedia?"Support Wikipedia":"Support MediaWiki"),this.$logo.empty(),!t.wikipedia&&t.source.logo&&this.$logo.append(e("<img>").attr("src",t.source.logo).attr("title",t.source.title))},t.prototype.buildPending=function(){return e("<div>").addClass("wl-pageInfoWidget-content-pending").append(this.messages.pending)},t.prototype.buildError=function(){return e("<div>").addClass("wl-pageInfoWidget-content-error").append(this.messages.error)},e.wikilookup.PageInfoWidget=t}(jQuery),function(s){function t(t,e){if(e=e||{},this.$container=t,!this.$container||!this.$container.length)throw new Error("wikilookup initialization error: Could not process given element.");this.prefetch=!!e.prefetch,this.selector=e.selector||"[data-wikilookup]",this.messages=e.messages||{},this.hideThumb=!!e.hideThumb,this.dark=!!e.dark,this.$nodes=s(),this.sources={},this.trigger=null,this.initializeNodes(),this.initializeSources(e.sources),this.setUpdateTrigger(e.trigger),e.prefetch&&this.updateAllNodes()}t.prototype.updateAllNodes=function(){var t=this;this.getNodes().each(function(){t.updateWidget(s(this))})},t.prototype.initializeNodes=function(){var i=this;this.$nodes=this.$container.find(this.selector).filter(function(){return!!(s(this).attr("data-wl-title")||s(this).text()).trim()}),this.$nodes.each(function(){var t,e=s(this).attr("data-wl-title")||s(this).text();s(this).attr("data-wl-title",e.trim()),t=new s.wikilookup.PageInfoWidget({messages:i.messages,hideThumb:i.hideThumb,dark:i.dark}),s(this).data("wl-widget",t)})},t.prototype.getSource=function(t){return t=t||"default",this.sources[t]||(t="default"),this.sources[t]},t.prototype.initializeSources=function(t){var e;for(e in t=s.extend({},t),this.sources={default:new s.wikilookup.Api},t)this.sources[e]=new s.wikilookup.Api(t[e])},t.prototype.setUpdateTrigger=function(t){var e=this;-1===["click","mouseenter"].indexOf(t)&&(t="click"),this.trigger!==t&&(this.getNodes().each(function(){e.trigger&&e.trigger!==t&&s(this).off(e.trigger+".wikilookupEvent"),s(this).on(t+".wikilookupEvent",e.onTriggerEvent.bind(e,s(this)))}),this.trigger=t)},t.prototype.updateWidget=function(t){var e=t.attr("data-wl-title"),i=t.attr("data-wl-source")||"default",s=t.attr("data-wl-lang"),o=t.data("wl-widget"),r=!!t.data("wl-state-fetching"),a=this.getSource(i);r||(a?"ready"!==o.getState()&&(t.data("wl-state-fetching",!0),a.getPageInfo(e,s).then(function(t){o.setData(t),o.setState("ready")},function(){o.setState("error")}).always(function(){t.data("wl-state-fetching",!1)})):console.error('wikilookup error: Could not recognize source "'+i+'".'))},t.prototype.onTriggerEvent=function(t){this.updateWidget(t)},t.prototype.getNodes=function(){return this.$nodes},t.prototype.getAllTerms=function(){var t=[];return this.$nodes.each(function(){t.push(s(this).attr("data-wl-title"))}),t},s.wikilookup.Processor=t}(jQuery),function(i){i.fn.wikilookup=function(t){var e=new i.wikilookup.Processor(i(this),t);i(this).data("wl-processor",e)}}(jQuery);